<!DOCTYPE HTML>
<html lang="en">

<head>
	<title>100 Biggest Data Breaches of 2017</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http - equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="https://use.typekit.net/dbv7que.css">
</head>

<body id="thebody">
	<main>
		<script src="//d3js.org/d3.v4.js"></script>
		<div id="mainwidth">
			<h1>100 Biggest Data Breaches of 2017</h1>
			<p>The ID Question is the latest series from How We Get To Next. It explores the larger implications of today's identity systems, such as India's national biometric identity project Aadhaar, and issues related to identity in the digital age.</p>

			<p>In this episode specifically, we examine individual power to control identities online when the state and corporations like Facebook and Google are the ones who control the way our data is stored, and in many cases, used. What happens when these organisations - whether government or corporate - are hacked, and our data is rendered vulnerable?</p>

			<p>We're not talking about hypotheticals though - this chart will show you the real extent of this problem. Have a play around by hovering over each circle. To read more, make sure you follow How We Get To Next online, and to discuss identities in more detail, join the series Facebook group.</p>
			<div id="chartgoeshere">
				<div id="tooltip" , class="hidden">
					<p><strong><span id = "tip-header">Header</span></strong></p>
					<p><em><span id="tip-location">Location</span></em></p>
					<p>Records lost: <span id="tip-records">9999</span></p>
				</div>
			</div>
			<div id="outro">
				<p>This bubble chart was created in <a href="https://d3js.org/">D3v4.js</a> by <a href="http://duncangeere.com">Duncan Geere</a> and <a href="http://storythings.com">Storythings</a> for <strong><a href="https://youtube.com/watch?v=L_jWHffIx5E">the ID Question</a></strong>. Data from <a href="http://breachlevelindex.com/data-breach-database">Breach Level Index</a>.</p>
			</div>

			<script>
				// This is the main chart script
				// Set chart size
				var margin = {
						top: 20,
						right: 30,
						bottom: 20,
						left: 80
					},
					width = 800 - margin.left - margin.right,
					height = 800 - margin.top - margin.bottom;

				// Create date/time parser
				var parseTime = d3.timeParse("%d/%m/%Y");

				// Create trackers for mobile touch and mouse coords
				var touched = false;

				// Create an end date for the Y axis
				var endDate = parseTime("31/12/2017")

				// Set ranges
				var x = d3.scaleLog()
					.range([0, width]);

				var y = d3.scaleTime()
					.range([0, height]);

				var r = d3.scaleSqrt()
					.range([3, 35]);

				// Add an SVG element
				var svg = d3.select("#chartgoeshere")
					.append("svg")
					.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom)
					.append("g")
					.attr("transform", "translate(" + margin.left + "," + margin.top + ")")

				// Get the data
				d3.csv("breach_level_index.csv", function(error, data) {
					if (error) throw error;

					// Format the data
					data.forEach(function(d) {
						d.date = parseTime(d.date) // date parse
						d.records = +d.records // integer size of breach
					});

					// Scale the range
					x.domain([10000, d3.max(data, function(d) {
						return d.records;
					})]).nice();

					y.domain([
						d3.min(data, function(d) {
							return d.date;
						}) - 20,
						endDate

						//d3.max(data, function(d) {
						//	return d.date;
						//})
					]);

					r.domain([
						d3.min(data, function(d) {
							return d.records;
						}),
						d3.max(data, function(d) {
							return d.records;
						})
					]).nice();

					// Add the dots
					svg.selectAll("dot")
						.data(data)
						.enter()
						.append("circle")
						.attr("r", function(d) {
							return r(d.records);
						})
						.attr("cx", function(d) {
							return x(d.records);
						})
						.attr("cy", function(d) {
							return y(d.date);
						})
						.attr("fill", "#e85859")

						// Add mouseover effect
						.on("mouseover", function(data) {
							d3.select(this)
								.transition()
								.attr("fill", "#6f9b94") // Change colour
								.attr("r", function(d) {
									return r(d.records) + 5; // Larger radius
								});

							// Update tooltip position and values
							var tip = d3.select("#tooltip")

							tip.style("left", (x(data.records) + document.getElementById("chartgoeshere").offsetLeft) + 90 + "px")
								.style("top", (y(data.date) + document.getElementById("chartgoeshere").offsetTop) + 30 + "px");


							tip.select("#tip-header")
								.text(data.organisation);

							tip.select("#tip-records")
								.text(d3.format(",d")(data.records));

							tip.select("#tip-location")
								.text(data.location);

							// Show the tooltip
							tip.classed("hidden", false);

						})

						// Add mouseout effect
						.on("mouseout", function(data) {
							d3.select(this)
								.transition()
								.attr("fill", "#e85859") // Regular colour again
								.attr("r", function(d) {
									return r(d.records); // Radius normal
								});

							// Hide the tooltip
							d3.select("#tooltip").classed("hidden", true);
						})

						// Add touch effect
						.on("touch", function(data) {
							// If a tooltip is displayed
							if (touched == false) {
								d3.select(this)
									.transition()
									.attr("fill", "#6f9b94") // Change colour
									.attr("r", function(d) {
										return r(d.records) + 5; // Larger radius
									});

								// Update tooltip position and values
								var tip = d3.select("#tooltip")

								tip.style("left", (x(data.records) + ((window.innerWidth - width + margin.left + margin.right) / 2)) + "px")
									.style("top", y(data.date) + "px");

								tip.select("#tip-header")
									.text(data.organisation);

								tip.select("#tip-records")
									.text(d3.format(",d")(data.records));

								tip.select("#tip-location")
									.text(data.location);

								// Show the tooltip
								window.setTimeout(function() {
									tip.classed("hidden", false);
								}, 200);

								touched = true;
							} else if (touched == true) {
								d3.select(this)
									.transition()
									.attr("fill", "#e85859") // Regular colour again
									.attr("r", function(d) {
										return r(d.records); // Radius normal
									});

								// Hide the tooltip
								d3.select("#tooltip").classed("hidden", true);

								touched = false;
							};
						});


					// Add the x axis
					svg.append("g")

						.attr("transform", "translate(0," + height + ")")
						.call(d3.axisBottom(x)
							.tickFormat(function(d) {
								return x.tickFormat(4, d3.format(",d"))(d)
							}));

					// Add the y axis
					svg.append("g")
						.call(d3.axisLeft(y));



				});

			</script>

		</div>
	</main>
</body>

</html>
